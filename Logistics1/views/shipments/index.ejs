<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> - Logistics Manager</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="app-container">
    <%- include('../partials/sidebar') %>

    <main class="main-content">
      <%- include('../partials/header') %>
      <%- include('../partials/alerts') %>

      <div class="section-header" style="margin-bottom: 20px;">
        <h2 class="section-title">Shipment Records</h2>
        <a href="/shipments/create" class="btn btn-primary">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Create New Shipment
        </a>
      </div>

      <div class="section">
        <!-- Filters -->
        <form method="GET" action="/shipments">
          <div class="filters">
            <div class="search-input">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              </svg>
              <input type="text" name="search" placeholder="Search shipments..." value="<%= filters.search || '' %>">
            </div>
            <select name="status" class="form-control filter-select">
              <option value="All Statuses">All Statuses</option>
              <option value="Pending" <%= filters.status === 'Pending' ? 'selected' : '' %>>Pending</option>
              <option value="In Transit" <%= filters.status === 'In Transit' ? 'selected' : '' %>>In Transit</option>
              <option value="Delivered" <%= filters.status === 'Delivered' ? 'selected' : '' %>>Delivered</option>
              <option value="Delayed" <%= filters.status === 'Delayed' ? 'selected' : '' %>>Delayed</option>
              <option value="Cancelled" <%= filters.status === 'Cancelled' ? 'selected' : '' %>>Cancelled</option>
            </select>
            <select name="origin" class="form-control filter-select">
              <option value="All Origins">All Origins</option>
              <% origins.forEach(origin => { %>
                <option value="<%= origin %>" <%= filters.origin === origin ? 'selected' : '' %>><%= origin %></option>
              <% }) %>
            </select>
            <button type="submit" class="btn btn-secondary">Filter</button>
          </div>
        </form>

        <!-- Table -->
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Shipment ID</th>
                <th>Sender</th>
                <th>Recipient</th>
                <th>Origin</th>
                <th>Destination</th>
                <th>Status</th>
                <th>Delivery Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% if (shipments.length === 0) { %>
                <tr>
                  <td colspan="8" style="text-align: center; padding: 40px; color: #666;">
                    No shipments found. <a href="/shipments/create">Create your first shipment</a>
                  </td>
                </tr>
              <% } else { %>
                <% shipments.forEach(shipment => { %>
                  <tr>
                    <td><%= shipment.shipmentId %></td>
                    <td><%= shipment.sender.name %></td>
                    <td><%= shipment.recipient.name %></td>
                    <td><%= shipment.origin %></td>
                    <td><%= shipment.destination %></td>
                    <td>
                      <span class="status-badge <%= shipment.status.toLowerCase().replace(' ', '-') %>">
                        <%= shipment.status %>
                      </span>
                    </td>
                    <td><%= shipment.deliveryDate ? new Date(shipment.deliveryDate).toLocaleDateString() : '-' %></td>
                    <td>
                      <a href="/shipments/<%= shipment._id %>" class="action-btn" title="View">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                          <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                      </a>
                      <a href="/shipments/<%= shipment._id %>/edit" class="action-btn" title="Edit">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                      </a>
                      <form action="/shipments/<%= shipment._id %>?_method=DELETE" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this shipment?');">
                        <button type="submit" class="action-btn delete" title="Delete">
                          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                          </svg>
                        </button>
                      </form>
                    </td>
                  </tr>
                <% }) %>
              <% } %>
            </tbody>
          </table>
        </div>

        <div class="pagination">
          <div class="pagination-info">Showing 1-<%= shipments.length %> of <%= shipments.length %> shipments</div>
          <div class="pagination-buttons">
            <a href="#" class="pagination-btn">&lt;</a>
            <a href="#" class="pagination-btn active">1</a>
            <a href="#" class="pagination-btn">&gt;</a>
          </div>
        </div>
      </div>

      <%- include('../partials/footer') %>
    </main>
  </div>
</body>
</html>
